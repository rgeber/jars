#V2
INFO FOR NS;
-- ########################################################################\n-- Specify the namespace and database that will be used.\n-- These values should match the custom claims that we configured before.\n-- FIXME: If needed, set up your SurrealDB namespace and database\nUSE NS jars DB jars;\n\n-- Define the scope where the token will be used.\n-- The name of the scope should match the custom claim that we configured before.\nDEFINE SCOPE user;\n\n-- Define the public key to verify tokens issued by Authentik for our application.\n-- The name of the token should match the custom claim that we configured before.\n-- FIXME: Add your authentication app JWKS URL\nDEFINE TOKEN authentik ON SCOPE user TYPE JWKS VALUE "https://auth.geber.io/application/o/jars/jwks/";\n\n-- ########################################################################\nDEFINE TABLE user SCHEMAFULL\n  -- Authorized users can select, update, delete and create user records.\n  -- Records that do not match the permissions will not be modified nor returned.\n  PERMISSIONS FOR select, update, delete, create\n  WHERE\n\n    -- The token scope must match the scope that we defined.\n    -- The name of the scope should match the scope that we defined before.\n    $scope = "user"\n\n    -- In authentik use the preview function of your provider to see the `aud` value.\n    -- FIXME: Changer this to YOUR audience value\n    AND $token.aud CONTAINS "6yeybrBPYSNdaXsuqujiVIn87Mj1OsUpeHd3yKlZ"\n\n    -- The email claim must match the email of the user being queried.\n    AND email = $token['https://surrealdb.com/email']\n    AND $token['https://surrealdb.com/email_verified'] = true\n;\n\n-- In this example, we will use the email as the primary identifier for a user.\nDEFINE INDEX email ON user FIELDS email UNIQUE;\nDEFINE FIELD email ON user TYPE string ASSERT string::is::email($value);\n-- We define some other information present in the token that we want to store.\nDEFINE FIELD name ON user TYPE string;\nDEFINE FIELD username ON user TYPE string;
INFO FOR DB
INFO FOR ns
